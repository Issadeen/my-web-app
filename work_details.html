<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Work Details</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/d00c9b568a.js" crossorigin="anonymous"></script>
  </head>
  <style>
    table {
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid white;
    }

    th, td {
      padding: 0.5rem;
    }

    th {
      text-align: left;
    }

    tr:nth-child(even) {
      background-color: #1f2937;
    }

    tr:nth-child(odd) {
      background-color: #111827;
    }

    tr:hover {
      background-color: #4b5563;
    }

    .bg-gray-900 {
      background-color: #111827;
    }

    .bg-gray-800 {
      background-color: #1f2937;
    }

    .bg-gray-700 {
      background-color: #374151;
    }

    .bg-gray-600 {
      background-color: #4b5563;
    }

    .bg-gray-500 {
      background-color: #6b7280;
    }

    .bg-gray-400 {
      background-color: #9ca3af;
    }

    .bg-gray-300 {
      background-color: #d1d5db;
    }

    .bg-gray-200 {
      background-color: #e5e7eb;
    }

    .bg-gray-100 {
      background-color: #f3f4f6;
    }

    .bg-gray-50 {
      background-color: #f9fafb;
    }

    .text-gray-900 {
      color: #111827;
    }

    .text-gray-800 {
      color: #1f2937;
    }

    .text-gray-700 {
      color: #374151;
    }

    .text-gray-600 {
      color: #4b5563;
    }

    .text-gray-500 {
      color: #6b7280;
    }

    .text-gray-400 {
      color: #9ca3af;
    }

    .text-gray-300 {
      color: #d1d5db;
    }

    .text-gray-200 {
      color: #e5e7eb;
    }

    .text-gray-100 {
      color: #f3f4f6;
    }

    .text-gray-50 {
      color: #f9fafb;
    }

    .hover\:bg-gray-900:hover {
      background-color: #111827;
    }

    .hover\:bg-gray-800:hover {
      background-color: #1f2937;
    }

    .hover\:bg-gray-700:hover {
      background-color: #374151;
    }


    .max-w-md {
  max-width: 100%;
}
  </style>
  <body class="bg-gray-900 text-white">
    <nav class="flex justify-between items-center p-4 bg-gray-800">
      <h1 class="text-2xl font-bold">Work Details</h1>
      <div>
        <button id="logout_button" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">Logout</button>
        <button id="add_button" class="ml-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded">Add Work Details</button>
      </div>
    </nav>
    <div class="max-w-md mx-auto my-10 p-8 bg-gray-800 rounded">
      <table class="table-auto w-full">
        <thead>
          <tr>
            <th class="px-4 py-2">Truck No</th>
            <th class="px-4 py-2">LO Company</th>
            <th class="px-4 py-2">Product</th>
            <th class="px-4 py-2">Observed Quantity</th>
          </tr>
        </thead>
        <tbody id="work_details_table_body">
          <!-- Table rows will be added dynamically using JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Add your JavaScript code here -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyDklv5Sgwiy84_fCOqiQRCiuTBVRZ_2EvY",
            authDomain: "my-1-wb.firebaseapp.com",
            projectId: "my-1-wb",
            storageBucket: "my-1-wb.appspot.com",
            messagingSenderId: "865633557898",
            appId: "1:865633557898:web:5e8a848b08d7475054bc73"
      };
      // Initialize Firebase app
      const app = firebase.initializeApp(firebaseConfig);

      // Get a reference to the Realtime Database
const db = firebase.database(app);

// Get a reference to the "work_details" node in the database
var workDetailsRef = db.ref("work_details");

// Listen for changes to the data in the "work_details" node
workDetailsRef.on("value", function(snapshot) {
  var workDetails = snapshot.val();
  if (workDetails) {
    // Clear the existing table rows
    var tableBody = document.getElementById("work_details_table_body");
    tableBody.innerHTML = "";

    // Loop through the child nodes of the "work_details" node
    snapshot.forEach(function(childSnapshot) {
      // Get the key and data of the current child node
      var childKey = childSnapshot.key;
      var childData = childSnapshot.val();

      // Create a new row for the current child node
      var row = tableBody.insertRow();
      row.insertCell().textContent = childData.truck_no;
      row.insertCell().textContent = childData.lo_company;
      row.insertCell().textContent = childData.product;
      row.insertCell().textContent = childData.observed_quantity;

      // Create a new cell for the delete button
      const deleteCell = row.insertCell();

      // Create a new delete button element
      const deleteButton = document.createElement('button');
      deleteButton.innerHTML = '<i class="fas fa-trash"></i>';

      // Add a click event listener to the delete button
      deleteButton.addEventListener('click', function() {
        // Prompt the user before deleting the row
        if (confirm("Are you sure you want to delete this row?")) {
          // Get a reference to the child node with the current key
          var childRef = workDetailsRef.child(childKey);

          // Remove the child node from the database
          childRef.remove();
        }
      });

      // Add the delete button to the new cell
      deleteCell.appendChild(deleteButton);

      // Create a new cell for the loaded button
      const loadedCell = row.insertCell();

      // Create a new loaded button element
      const loadedButton = document.createElement('button');
      loadedButton.innerText = 'Loaded';

      // Check if the row is already marked as loaded in the database
if (childData.loaded) {
  // Mark the row as loaded
  row.classList.add("loaded");
  // Disable the loaded button
  loadedButton.disabled = true;
  // Replace the name "Loaded" with a tick icon
  loadedButton.innerHTML = '<i class="fas fa-check"></i>';
}


      // Add a click event listener to the loaded button
loadedButton.addEventListener('click', function() {
  // Mark the row as loaded
  row.classList.add("loaded");
  // Disable the loaded button
  loadedButton.disabled = true;
  // Replace the name "Loaded" with a tick icon
  loadedButton.innerHTML = '<i class="fas fa-check"></i>';
  // Get a reference to the child node with the current key
  var childRef = workDetailsRef.child(childKey);
  // Update the loaded field of the child node in the database
  childRef.update({loaded: true});
});


      // Add the loaded button to the new cell
      loadedCell.appendChild(loadedButton);
    });
  }
});

// Handle "Add Work Details" button click
document.getElementById("add_button").addEventListener("click", function() {
  window.location.href = "add_work_detail.html";
});

// Logout user after 4 or 5 minutes of inactivity
var logoutTimer = null;
function resetLogoutTimer() {
  if (logoutTimer) {
    clearTimeout(logoutTimer);
  }
  logoutTimer = setTimeout(function() {
    // TODO: Logout user
    alert("You have been logged out due to inactivity.");
  }, 5 * 60 * 1000); // 5 minutes
  logoutTimer = setTimeout(function() {
    // TODO: Logout user
    alert("You have been logged out due to inactivity.");
  }, 4 * 60 * 1000); // 4 minutes
}
resetLogoutTimer();
document.addEventListener("mousemove", resetLogoutTimer);
document.addEventListener("keypress", resetLogoutTimer);

// Handle "Logout" button click
document.getElementById("logout_button").addEventListener("click", function() {
  firebase.auth().signOut().then(function() {
    resetLogoutTimer(); // Reset the logout timer
    window.location.href = "index.html";
  }).catch(function(error) {
    alert("An error occurred while logging out.");
  });
});
    </script>
  </body>
</html>