<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Wallet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css">
  </head>
  <style>
        .max-w-md {
  max-width: 100%;
}

table {
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid white;
    }

    th, td {
      padding: 0.5rem;
    }

    th {
      text-align: left;
    }

    tr:nth-child(even) {
      background-color: #1f2937;
    }

    tr:nth-child(odd) {
      background-color: #111827;
    }

    tr:hover {
      background-color: #4b5563;
    }

    .bg-gray-900 {
      background-color: #111827;
    }

    .bg-gray-800 {
      background-color: #1f2937;
    }

    .bg-gray-700 {
      background-color: #374151;
    }

    .bg-gray-600 {
      background-color: #4b5563;
    }

    .bg-gray-500 {
      background-color: #6b7280;
    }

    .bg-gray-400 {
      background-color: #9ca3af;
    }

    .bg-gray-300 {
      background-color: #d1d5db;
    }

    .bg-gray-200 {
      background-color: #e5e7eb;
    }

    .bg-gray-100 {
      background-color: #f3f4f6;
    }

    .bg-gray-50 {
      background-color: #f9fafb;
    }

    .text-gray-900 {
      color: #111827;
    }

    .text-gray-800 {
      color: #1f2937;
    }

    .text-gray-700 {
      color: #374151;
    }

    .text-gray-600 {
      color: #4b5563;
    }

    .text-gray-500 {
      color: #6b7280;
    }

    .text-gray-400 {
      color: #9ca3af;
    }

    .text-gray-300 {
      color: #d1d5db;
    }

    .text-gray-200 {
      color: #e5e7eb;
    }

    .text-gray-100 {
      color: #f3f4f6;
    }

    .text-gray-50 {
      color: #f9fafb;
    }

    .hover\:bg-gray-900:hover {
      background-color: #111827;
    }

    .hover\:bg-gray-800:hover {
      background-color: #1f2937;
    }

    .hover\:bg-gray-700:hover {
      background-color: #374151;
    }


    .max-w-md {
  max-width: 100%;
}

button.paid {
  background-color: rgb(15, 15, 15);
  color: #fff;
  border: none;
}

button.paid::after {
  content: "\2713";
}


  </style>
  <body class="bg-gray-900 text-white">
    <!-- Prompt the user for the access code -->
    <script>
      // Prompt the user for the access code
      var accessCode = prompt("Please enter the access code:");

      // Check if the entered code is correct
      if (accessCode === "AI230032") {
        // Code is correct, allow access to the wallet page
        // ... (rest of your JavaScript code for the wallet page) ...
      } else {
        // Code is incorrect, redirect or show an error message
        alert("Invalid access code. You will be redirected.");
        window.location.href = "index.html"; // Redirect to the index page or another appropriate page
      }
    </script>
    <nav class="flex justify-between items-center p-4 bg-gray-800">
      <h1 class="text-2xl font-bold">Wallet</h1>
      <div>
        <button id="logout_button" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">Logout</button>
      </div>
    </nav>
<div> <span id="totalAmount">0</span></div>
    <div class="max-w-md mx-auto my-10 p-8 bg-gray-800 rounded">
      <table class="table-auto w-full">
        <thead>
          <tr>
            <th class="px-4 py-2">Truck No</th>
            <th class="px-4 py-2">LO Company</th>
            <th class="px-4 py-2">Product</th>
            <th class="px-4 py-2">Observed Quantity</th>
            <th class="px-4 py-2">Amount</th>
            <th class="px-4 py-2">Paid</th>
          </tr>
        </thead>
        <tbody id="wallet_table_body">
          <!-- Table rows will be added dynamically using JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Add your JavaScript code here -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>


<script>
  var firebaseConfig = {
           apiKey: "AIzaSyDklv5Sgwiy84_fCOqiQRCiuTBVRZ_2EvY",
            authDomain: "my-1-wb.firebaseapp.com",
            projectId: "my-1-wb",
            storageBucket: "my-1-wb.appspot.com",
            messagingSenderId: "865633557898",
            appId: "1:865633557898:web:5e8a848b08d7475054bc73"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database(app);
  var workDetailsRef = db.ref("work_details");

  // Create an array to store input elements for each truck
  var amountInputs = [];

  function updateTotalAmount() {
    var totalAmount = 0;
    amountInputs.forEach(function(input) {
      var amount = parseInt(input.value) || 0;
      totalAmount += amount;
    });
    totalAmountElement.textContent = "Total amount: " + totalAmount;
  }

 // Listen for changes to the data in the "work_details" node
workDetailsRef.on("value", function(snapshot) {
  var workDetails = snapshot.val();
  if (workDetails) {
    // Clear the existing table rows
    var tableBody = document.getElementById("wallet_table_body");
    tableBody.innerHTML = "";

    // Initialize the total amount to zero
    var totalAmount = 0;

    // Loop through the child nodes of the "work_details" node
    snapshot.forEach(function(childSnapshot) {
      // Get the key and data of the current child node
      var childKey = childSnapshot.key;
      var childData = childSnapshot.val();

      // Check if the truck is loaded
      if (childData.loaded) {
        // Create a new row for the current child node
        var row = tableBody.insertRow();

        var truckNoCell = row.insertCell();
          truckNoCell.textContent = childData.truck_no;
          truckNoCell.style.border = "1px solid black";

          var loCompanyCell = row.insertCell();
          loCompanyCell.textContent = childData.lo_company;
          loCompanyCell.style.border = "1px solid black";

          var productCell = row.insertCell();
          productCell.textContent = childData.product;
          productCell.style.border = "1px solid black";

          var observedQuantityCell = row.insertCell();
          observedQuantityCell.textContent = childData.observed_quantity;
          observedQuantityCell.style.border = "1px solid black";

          var amountCell = row.insertCell();
          amountCell.style.border = "1px solid black";
          var amountInput = document.createElement("input");
          amountInput.type = "text";
          amountInput.placeholder = "Enter amount";
          amountInput.style.backgroundColor = getComputedStyle(row).backgroundColor;
          amountInput.style.color = "#fff";
          amountInput.setAttribute("data-id", childKey);
          amountInput.addEventListener("input", function() {
            var cleanedValue = this.value.replace(/[^0-9]/g, "");
            this.value = cleanedValue;
            updateTotalAmount();
            var childRef = workDetailsRef.child(childKey);
            childRef.update({ amount: cleanedValue });
          });
          amountCell.appendChild(amountInput);
          amountInputs[childKey] = amountInput;
          amountInput.value = childData.amount || "";

          var payCell = row.insertCell();
          payCell.style.border = "1px solid black";
          var payButton = document.createElement("button");
          payButton.textContent = "Pay";
          payButton.addEventListener("click", function() {
            var amount = amountInputs[childKey].value;

            if (amount !== "") { // Check if amount is not empty
              var childRef = workDetailsRef.child(childKey);
              childRef.update({ paid: true, amount: amount });
              payButton.classList.toggle("paid");
            }
          });
          payCell.appendChild(payButton);

        // Add an event listener to the amount input field that updates the total amount whenever the user enters or changes an amount
        amountInput.addEventListener("input", function() {
          // Remove any non-numeric characters from the input value
          var cleanedValue = this.value.replace(/[^0-9]/g, "");
          this.value = cleanedValue;
          // Update the "amount" field of the child node in the database
          var childRef = workDetailsRef.child(childKey);
          childRef.update({ amount: cleanedValue });
          // Set the value of the amount cell to the input value
          var amountCellId = "amountCell_" + this.getAttribute("data-id");
          var amountCell = document.getElementById(amountCellId);
          amountCell.textContent = cleanedValue;
          // Update the total amount
          totalAmount = 0;
          snapshot.forEach(function(childSnapshot) {
            var childData = childSnapshot.val();
            if (childData.loaded && childData.amount && !isNaN(childData.amount)) {
              totalAmount += parseInt(childData.amount);
            }
          });
          // Display the total amount in your desired location (e.g., an HTML element with id "totalAmount")
          if (totalAmountElement) {
            totalAmountElement.textContent = "Total Amount: " + totalAmount;
          }
        });

        // Set the "paid" class on the pay button if the "paid" field is true
        if (childData.paid) {
          payButton.classList.add("paid");
        }

        // Calculate the total amount for each input entered
        if (childData.amount && !isNaN(childData.amount)) {
          totalAmount += parseInt(childData.amount);
        }
      }
    });

    // Define totalAmountElement after the loop
    var totalAmountElement = document.getElementById("totalAmount");

    // Display the total amount in your desired location (e.g., an HTML element with id "totalAmount")
    if (totalAmountElement) {
      totalAmountElement.textContent = "Total Amount: " + totalAmount;
    }
  }
});
</script>
<script>

      // Logout user after 4 or 5 minutes of inactivity
      var logoutTimer = null;
      function resetLogoutTimer() {
        if (logoutTimer) {
          clearTimeout(logoutTimer);
        }
        logoutTimer = setTimeout(function() {
          // TODO: Logout user
          alert("You have been logged out due to inactivity.");
        }, 5 * 60 * 1000); // 5 minutes
        logoutTimer = setTimeout(function() {
          // TODO: Logout user
          alert("You have been logged out due to inactivity.");
        }, 4 * 60 * 1000); // 4 minutes
      }
      resetLogoutTimer();
      document.addEventListener("mousemove", resetLogoutTimer);
      document.addEventListener("keypress", resetLogoutTimer);

      // Handle "Logout" button click
      document.getElementById("logout_button").addEventListener("click", function() {
        firebase.auth().signOut().then(function() {
          resetLogoutTimer(); // Reset the logout timer
          window.location.href = "index.html";
        }).catch(function(error) {
          alert("An error occurred while logging out.");
        });
      });
    </script>
  </body>
</html>