<!DOCTYPE html>
<html lang="en" class="bg-white dark:bg-gray-800">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
<style>
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    #dataContainer {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px;
    }

    body.dark {
        /* Dark theme */
        background-color: black;
        color: white;
    }
    .card__details {
        text-align: center;
    }

    .card__title {
        font-family: 'auto', cursive; /* Replace with the actual font name */
        font-size: 1.5em;
        color: #fff;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        font-style: italic; /* Make the title italic */

    }
    .card {
        width: 300px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        margin: 20px auto; /* 20px top and bottom margin, auto left and right margin */
        background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
    }

    .card__chip {
        position: center;
        width: 50px;
        height: 40px;
        background: #ddd;
        border-radius: 8px;
    }

    .card__logo {
        align-self: flex-end;
    }

    .card__number,
    .card__name,
    .card__expiry {
        color: #fff;
        text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
    }
    .card:hover {
        transform: scale(1.05); /* Make the card slightly larger */
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* Increase the shadow */
        transition: all 0.3s ease; /* Animate the changes */
    }
    .data-card {
        width: 270px; /* Reduced width */
        height: auto; /* Make the height adjust to the content */
        overflow: auto; /* Add scrollbars if the content is too large */
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2), 0 0 10px rgba(0, 0, 0, 0.1); /* Added box shadow */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        margin: 20px auto; /* 10px vertical margin, auto horizontal margin */
        background: var(--light-background);
        border: 2px solid blue; /* Added blue border */
        backface-visibility: hidden;
        transform-style: preserve-3d;
    }
    
    .data-card:hover {
        transform: scale(1.05); /* Make the card slightly larger */
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); /* Increase the shadow */
        transition: all 0.3s ease; /* Animate the changes */
    }
    .theme-dark {
        background-color: #2d3748; /* This is the color for bg-gray-800 */
        color: #fff; /* This is the color for text-white */
    }

    .theme-light {
        background-color: #fff; /* This is the color for bg-white */
        color: #1a202c; /* This is the color for text-gray-900 */
    }
</style>
</head>
<body class="dark">
    <nav class="flex items-center justify-between p-6 bg-gray-800">
        <div class="text-2xl font-semibold text-white">Wallet</div>
        <div class="flex items-center">
            <button id="themeToggle" class="px-4 py-2 text-white bg-blue-500 rounded">Toggle Theme</button>
        </div>
    </nav>
    <div class="card">
        <div class="card__chip"></div>
        <div class="card__logo">
        </div>
        <div class="card__details">
            <h2 class="card__title">Issaerium-23 Card</h2>
            <p id="totalAmount" class="card__amount">Total Amount: $0</p>
        </div>
    </div>
    <div id="dataContainer" class="mt-10"></div>
    <script>
        // Add Firebase to your JavaScript project


// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database(app);
var workDetailsRef = db.ref("work_details");

// Check user's sign-in state
firebase.auth().onAuthStateChanged(function(user) {
  if (!user) {
    // User is not signed in, redirect to index.html
    window.location.href = "index.html";
  }
});

<!-- Prompt the user for the access code -->
    
      // Prompt the user for the access code
      var accessCode = prompt("Please enter the access code:");

      // Check if the entered code is correct
      if (accessCode === "AI230032") {
        // Code is correct, allow access to the wallet page
        // ... (rest of your JavaScript code for the wallet page) ...
      } else {
        // Code is incorrect, redirect or show an error message
        alert("Invalid access code. You will be redirected.");
        window.location.href = "index.html"; // Redirect to the index page or another appropriate page
      }
    

document.getElementById('themeToggle').addEventListener('click', function() {
    document.body.classList.toggle('dark');
});

let totalAmount = 0;
const dataContainer = document.getElementById('dataContainer');

// Fetch data from Firebase
workDetailsRef.on('value', (snapshot) => {
        // Clear existing data
        dataContainer.innerHTML = '';
        totalAmount = 0;

    const data = snapshot.val();
    if (data) { // Check if data exists
        const dataArray = Object.entries(data); // Convert object to array

        dataArray.forEach(([key, item]) => {

     
        // Check if the truck is loaded
        if (item.loaded) {
        // Check if item.amount is a valid number before adding
        if (!isNaN(item.amount)) {
            totalAmount += Number(item.amount);
        }
    

        const card = document.createElement('div');
        card.className = 'data-card';
        card.className = 'data-card bg-white dark:bg-gray-800 shadow rounded p-6 my-4';

        const truckNo = document.createElement('p');
        truckNo.textContent = `Truck No: ${item.truck_no}`; // Updated
        card.appendChild(truckNo);

        const loadingCompany = document.createElement('p');
        loadingCompany.textContent = `LO Company: ${item.lo_company}`; // Updated
        card.appendChild(loadingCompany);

        const product = document.createElement('p');
        product.textContent = `Product: ${item.product}`;
        card.appendChild(product);

        const observedQuantity = document.createElement('p');
        observedQuantity.textContent = `Observed Quantity: ${item.observed_quantity}`; // Updated
        card.appendChild(observedQuantity);

        const amount = document.createElement('div');
        amount.textContent = `Amount: $${item.amount}`;
        amount.contentEditable = true; // Make the div editable
        amount.addEventListener('blur', function(e) {
            // Extract the number from the text content
            const newAmount = Number(this.textContent.replace('Amount: $', ''));
            if (!isNaN(newAmount)) {
                // Subtract the old amount and add the new amount
                totalAmount = totalAmount - Number(item.amount) + newAmount;
                document.getElementById('totalAmount').textContent = `Total Amount: $${totalAmount}`;
                // Update the item amount
                item.amount = newAmount;
                // Save the new amount to Firebase
                workDetailsRef.child(key).update({ amount: newAmount });  
            }
        });

        card.appendChild(amount);

        const paidButton = document.createElement('button');
        paidButton.textContent = 'Paid?';
        paidButton.className = 'px-4 py-2 mt-4 text-white bg-blue-500 rounded';

        // Disable the button if the amount is zero or undefined
        if (item.amount === 0 || item.amount === undefined) {
            paidButton.disabled = true;
        }

        // If the item is paid, strike through the amount and disable editing
        if (item.paid) {
            amount.style.textDecoration = 'line-through';
            amount.contentEditable = false;
            paidButton.textContent = 'âœ“';
            paidButton.disabled = true;
        }

        paidButton.addEventListener('click', function() {
    paidButton.textContent = 'âœ“';
    paidButton.disabled = true;
    amount.style.textDecoration = 'line-through';
    amount.contentEditable = false;

    // Get the current timestamp
    const paidTimestamp = Date.now();

    // Update the item status and paid timestamp in Firebase
    workDetailsRef.child(key).update({ paid: true, paidTimestamp });

    // Start a 1-minute countdown
    let timeLeft = 60; // 1 minute in seconds
    const countdown = document.createElement('p');
    card.appendChild(countdown);
    const countdownInterval = setInterval(() => {
        timeLeft--;
        countdown.textContent = `Time left: ${timeLeft} seconds`;
        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            // Delete data from Firebase when countdown reaches zero
            workDetailsRef.child(key).remove();
            card.remove();
        }
    }, 1000);

    // If the item is paid, calculate the remaining time
    if (item.paid && !isNaN(item.paidTimestamp)) {
        const now = Date.now();
        const timePassed = Math.floor((now - paidTimestamp) / 1000); // Time passed in seconds
        let timeLeft = 60 - timePassed; // Remaining time in seconds

        const countdown = document.createElement('div'); // Create a new countdown element for this card
        card.appendChild(countdown); // Add the countdown element to the card

        const countdownInterval = setInterval(() => {
            timeLeft--;
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            countdown.textContent = `Time left: ${minutes} minutes ${seconds} seconds`;
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                // Delete data from Firebase when countdown reaches zero
                workDetailsRef.child(key).remove();
                card.remove();
            }
        }, 1000);
    }
});


        



            // Strike through the amount if the item is paid
            if (item.paid) {
                amount.style.textDecoration = 'line-through';
                paidButton.textContent = 'âœ“';
                paidButton.disabled = true;
            }

            card.appendChild(paidButton);
            dataContainer.appendChild(card);
        }
     else {
        // If there's no data, show a message to the user
        dataContainer.innerHTML = 'No loaded trucks for now, You can Check back later to see if any ðŸ˜Š';
    }
        });

    document.getElementById('totalAmount').textContent = `Total Amount: $${totalAmount}`;
    }
});

document.getElementById('themeToggle').addEventListener('click', function() {
    var elements = document.body.getElementsByTagName('*');

    // Include the html element in the elements array
    elements = Array.from(elements).concat([document.documentElement]);

    elements.forEach(function(element) {
        // Toggle background color
        if (element.classList.contains('bg-gray-800')) {
            element.classList.remove('bg-gray-800');
            element.classList.add('bg-white');
        } else if (element.classList.contains('bg-white')) {
            element.classList.remove('bg-white');
            element.classList.add('bg-gray-800');
        }

        // Toggle text color
        if (element.classList.contains('text-white')) {
            element.classList.remove('text-white');
            element.classList.add('text-gray-900');
        } else if (element.classList.contains('text-gray-900')) {
            element.classList.remove('text-gray-900');
            element.classList.add('text-white');
        }
    });

    // Toggle the theme-specific class for the html element
    document.documentElement.classList.toggle('theme-dark');
    document.documentElement.classList.toggle('theme-light');
});


    </script>
</body>
</html>
